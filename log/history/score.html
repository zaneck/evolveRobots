<!DOCTYPE html>
<meta charset="utf-8">
<head>
        <link rel="stylesheet" type="text/css" href="evolvebot.css"/>
</head>
<body>

<div class='title'>Scoring view</div>
<br>
<hr>
<div class='desc'>
In a single view we display all the candidates that appears during a run of the algorithm. <br>
They are ordered according to their "birthdate". <br>
The color is representing the generation. It is possible to visualize the parent of a candidate by 
putting the mouse over. The lower part of the screen encode how the entry was generated (corss, add, del) 
<br>
</div>
<hr>

<script src="tools.js"></script>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>
d3.csv("history.csv", function(dataset) {
        var posdatax={}
        var posdatay={}
        var colorset = {}
        var gensize = {}
        var genbegin = {}
        var genarray = []
        var links = []
        var maxscore = 400
        dataset.forEach(function(d) {
                colorset[d.gen] = randomColor() 
                genbegin[d.gen] = 1000000000
                if(d.gen in gensize){
                        gensize[d.gen] = 0
                        genarray[d.gen] += 1 
                }else{
                        gensize[d.gen] = 0
                        genarray.push(1) 
                }
                if(maxscore<d.score)
                        maxscore=d.score
                
                if(d.a!='None'){
                        links.push({"src":d.id, "tgt":d.a, "type":d.type})
                        if(d.b!='None')
                                links.push({"src":d.id, "tgt":d.b, "type":d.type})
                }
        })
        var boxw = 2048.0/dataset.length;
        var boxh = 400;
        var h = 500;
      
        var selectedCandidates = []
                              
        var svg = d3.select("body")
                    .append("svg")
                    .attr("height", 500)
                    .attr("width", 2048)
                    .attr("style", "float: left; margin-right: 1%; margin-bottom: 0.5em;")
                    
        d3.select("body")
                .append("p")
                .attr("style", "clear: both;")

        var rects = svg.selectAll("rect")
                .data(dataset)
                .enter()
                .append("rect");
               
        rects.attr("x",  function(d,i){ 
                                var val = i*(boxw) 
                                posdatax[d.id] = val 
                                return val
                         })
                .attr("y", function(d,i){ 
                        return 400-(d.score/maxscore)*boxh})
                .attr("width", boxw+2)
                .attr("height", function(d,i){return d.score/maxscore*boxh; })
                .attr("fill", function(d,i){return colorset[d.gen] }) 
                .on("mouseenter", mouseover)
                .on("mouseleave", mouseout)
                .on("click", mouseclick)
                .attr("id", function(d){return "score-"+d.id;} )

         var rects = svg.selectAll("rect2")
                .data(dataset)
                .enter()
                .append("rect");
                rects.attr("x",    function(d,i){ 
                        var val = i*(boxw) 
                        posdatax[d.id] = val 
                        return val }
                    )
                .attr("y", function(d,i){ 
                        return 410})
                .attr("width", boxw)
                .attr("height", function(d,i){return 50; })
                .attr("fill", function(d,i){
                        if(d.type=="D")
                                return "#F00"
                        if(d.type=="X")
                                return "#FF0"
                        if(d.type=="A")
                                return "#00F"
                        if(d.type=="N")
                                return "#0F0"
                        return "#000"
                 }
                 )
                    
        
       
        function mouseclick(d){
                //      window.open( "../generation"+d.gen+"/index.html", "_self")
        }
       
        function mouseover(d) {
              svg.selectAll("#score-"+d.id)
                  .style("fill", "#F00") 
              
              svg.selectAll("text")
                 .remove()
                 .data([1])
                 .enter()
                 .append("text")
                 .text( d.id+": "+d.score )
                 .attr("x", d.id*(boxw) + boxw/2 )
                 .attr("y", 200 )
                 .attr("font-family", "sans-serif")
                 .attr("font-size", "30px")
                 .attr("fill", "#000")
                 .attr("font-weight", "bold")
                 .attr("text-anchor", "left")
        }       

        function mouseout(d) {
               svg.selectAll("#score-"+d.id)
                  .style("fill", colorset[d.gen]) 
        
        }
        
});

</script>

</body>


