<!DOCTYPE html>
<meta charset="utf-8">
<style>

.node circle {
  fill: #999;
}

.node text {
  font: 10px sans-serif;
}

.node--internal circle {
  fill: #555;
}

.node--internal text {
  text-shadow: 0 1px 0 #fff, 0 -1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff;
}

.link {
  fill: none;
  stroke: #555;
  stroke-opacity: 0.4;
  stroke-width: 1.5px;
}

div.candidate {
    display: inline-block;
    width: 50px;
    height: 20px;   /* We'll override this later */
    background-color: teal;
    margin-right: 2px;
    text-align: center;
}

.link {
  fill: none;
  stroke: #555;
  stroke-opacity: 0.5;
  stroke-width: 1.5px;
}

.link.source {
  stroke-width: 4.0px;
  stroke-opacity: 1.0;
  fill: #900;
}

.title
{
        font: 40px sans-serif;
}

.desc
{
        font: 15px sans-serif;
}

</style>
<body>

<div class='title'>History view</div>
<br>
<hr>
<div class='desc'>
In a single view we display all the candidates that appears during a run of the algorithm. <br>
They are ordered according to their "birthdate". <br>
The color is representing the generation. It is possible to visualize the parent of a candidate by 
putting the mouse over. <br>
</div>
<hr>

<script src="https://d3js.org/d3.v4.min.js"></script>
<script>
// This function randomColor has been cut&pasted from somewhere...forgot its author. 
// If you know him please contact me to add proper credits here. 
var randomColor = (function(){
var golden_ratio_conjugate = 0.618033988749895;
var h = Math.random();
var hslToRgb = function (h, s, l){
var r, g, b;
if(s == 0){
r = g = b = l; // achromatic
}else{
function hue2rgb(p, q, t){
if(t < 0) t += 1;
if(t > 1) t -= 1;
if(t < 1/6) return p + (q - p) * 6 * t;
if(t < 1/2) return q;
if(t < 2/3) return p + (q - p) * (2/3 - t) * 6;
return p;
}
var q = l < 0.5 ? l * (1 + s) : l + s - l * s;
var p = 2 * l - q;
r = hue2rgb(p, q, h + 1/3);
g = hue2rgb(p, q, h);
b = hue2rgb(p, q, h - 1/3);
}
return '#'+Math.round(r * 255).toString(16)+Math.round(g * 255).toString(16)+Math.round(b * 255).toString(16);
};
return function(){
h += golden_ratio_conjugate;
h %= 1;
return hslToRgb(h, 0.5, 0.60);
};
})();

d3.csv("history.csv", function(dataset) {
        var colorset = {}
        dataset.forEach(function(d) {
                colorset[d.gen] = randomColor() 
        })
        
        var boxw = 50;
        var boxh = 20;
        var h = 500;

        var svg = d3.select("body")
                    .append("svg")
                    .attr("width", 1600)
                    .attr("height", 2048);

        var rects = svg.selectAll("rect")
                .data(dataset)
                .enter()
                .append("rect");
    
        rects.attr("x",    function(d,i){ return (i%30)*(boxw+1) })
                .attr("y", function(d,i){ return Math.floor((i/30))*(boxh+10) })
                .attr("width", boxw)
                .attr("height", boxh)
                .attr("fill", function(d,i){return colorset[d.gen] }) 
                .on("mouseover", mouseover)
                .on("mouseout", mouseout)
                .attr("id", function(d){return d.id;} )

        svg.selectAll("text")
                .data(dataset)
                .enter()
                .append("text")
                .text(function(d) { return d.id })
                .attr("x", function(d, i) {
                        return (i%30)*(boxw+1) + boxw/2 ;
                })
                .attr("y", function(d,i){ return Math.floor((i/30))*(boxh+10)+15 })
                .attr("font-family", "sans-serif")
                .attr("font-size", "12px")
                .attr("fill", "white")
                .attr("font-weight", "bold")
                .attr("text-anchor", "middle")
                .on("mouseover", mouseover)
                .on("mouseout", mouseout)
                
       var link = svg.selectAll(".link")
        .data(dataset)
        .enter().append("path")
        .attr("class", "link")
        .attr("id",function(d, i){ return "node-"+d.id;}) 
        .attr("d", function(d, i) {
                if(d.a == 'None')
                        return "";
                
                var x = (i%30)*(boxw+1)+boxw/2
                var y = Math.floor((i/30))*(boxh+10)
                var tx = (d.a%30)*(boxw+1)+boxw/2
                var ty = Math.floor((d.a/30))*(boxh+10)+boxh
                return "M" + [x,y]
                        + "L" + [tx,ty];
        });
        
        function changeParent(id,state){
                svg.selectAll("#node-" + id)
                              .classed("source", state);
                if( dataset[id].a == 'None')
                        return;
                              
                changeParent(dataset[id].a, state)
        }
        
        function displayCandidate(id, state){
                var link = svg.selectAll(".link")
        }
       
        function mouseover(d) {
                changeParent(d.id, true) 
                displayCandidate(d.id)
        }       

        function mouseout(d) {
                changeParent(d.id, false)
        }
        
});

//var dataset = [ [1,'N','None', 'None', 0], [2,'N','None', 'None', 0], [3, 'A', 1, 'None', 1], [4, 'X', 1, 2, 1]   ];
</script>

</body>


